# diagnosis/logic.py
import random

# ここは「絶対に変えない」固定文（あなた指定の文言そのまま）
CTA_TEXT = (
    "もう少し言葉を受け取りたいと思われたらこちらからご連絡ください。\n"
    "1通のメールをお返しします。"
)

MESSAGES = {
    "light": {
        "observation": [
            "今回は、ふだんは自分の感覚で決められる場面が多いように見えます。",
            "今回の回答は、基本は自分で選べている状態を示しています。",
        ],
        "mirror": [
            "ただ、忙しい時や焦っている時だけ、つい相手に合わせて決めてしまうことがありそうです。",
            "ただ、状況が重なると「波風が立たない方」を先に選びやすい場面がありそうです。",
        ],
        "lead": [
            "そういう時は、気づかないうちに“安全な選び方”が優先になりやすいです。",
            "その瞬間だけ、判断の基準が自分より外に寄りやすくなります。",
        ],
        "question": [
            "そのことに、気づいていますか？",
            "最近その場面、増えていませんか？",
        ],
    },

    "middle": {
        "observation": [
            "今回は、自分で決めたい気持ちがあるのに、最後に人の反応が気になりやすい状態が見えます。",
            "今回の回答は、「自分で選ぶ」と「人に合わせる」が場面で入れ替わりやすい傾向を示しています。",
        ],
        "mirror": [
            "誰かの期待を感じた瞬間に、本音より“正しそうな答え”を探しやすいかもしれません。",
            "相手の表情や空気を読んだ時に、判断が揺れやすいかもしれません。",
        ],
        "lead": [
            "その結果、決めたあとに「これでよかったかな」が頭の中に残りやすくなります。",
            "そうなると、決めること自体が重たくなって、疲れが後から来やすいです。",
        ],
        "question": [
            "そのことに、気づいていますか？",
            "思い当たる場面が、いま浮かびますか？",
        ],
    },

    "strong": {
        "observation": [
            "今回は、人の反応を優先して決めることが多くなっている状態が見えます。",
            "今回の回答からは、「自分の気持ちより先に相手を優先する」が続いている感じが出ています。",
        ],
        "mirror": [
            "そのぶん、自分の本音がどこにあるのか分かりにくくなっている可能性があります。",
            "周囲に合わせることが続くと、自分の感覚が後ろに下がってしまうことがあります。",
        ],
        "lead": [
            "本当は違うと思っても、まず“安全な返し方”を選ぶ癖が残りやすい状態です。",
            "「自分はどうしたい？」より先に、「どう見られるか」が立ち上がりやすい状態です。",
        ],
        "question": [
            "そのことに、気づいていますか？",
            "それに気づいた時、何が変わりそうですか？",
        ],
    },
}

def get_level(score: int) -> str:
    if score >= 22:
        return "strong"
    elif score >= 14:
        return "middle"
    else:
        return "light"

def build_message(score: int) -> dict:
    level = get_level(score)
    data = MESSAGES[level]
    return {
        "level": level,  # これは内部用（画面に出さない）
        "observation": random.choice(data["observation"]),
        "mirror": random.choice(data["mirror"]),
        "lead": random.choice(data["lead"]),
        "question": random.choice(data["question"]),
        "cta": CTA_TEXT,
    }
