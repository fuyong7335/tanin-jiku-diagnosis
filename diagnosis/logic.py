# diagnosis/logic.py
# 役割：合計スコアからパターン判定し、結果メッセージを返す

def get_level(score: int) -> str:
    # 0..30（10問×0..3）
    if score >= 22:
        return "strong"   # パターンC
    elif score >= 14:
        return "middle"   # パターンB
    else:
        return "light"    # パターンA


COMMON_END = (
    "この画面を閉じても、\n"
    "何も変わらなくて大丈夫です。\n\n"
    "また思い出したとき、\n"
    "もう一度開いてもらえたら、\n"
    "それで十分です。"
)

MESSAGES = {
    "light": {  # パターンA
        "title": "診断メッセージ",
        "observation": (
            "今のあなたは、\n"
            "周りをよく見ながら、\n"
            "その中でどう振る舞えばいいかを、\n"
            "ずっと考えてきた人なのかもしれません。"
        ),
        "needle": (
            "大きく迷っているわけではないけれど、\n"
            "気づくと「自分はどうしたいんだっけ」と\n"
            "立ち止まる瞬間がある。\n\n"
            "それは、弱さではありません。\n"
            "人との関係を大切にしてきた証です。\n\n"
            "もし最近、\n"
            "「大丈夫」と言ったあとに\n"
            "少しだけ疲れが残ることがあったなら、\n"
            "今日はその感覚を否定しなくて大丈夫です。\n\n"
            "答えは、今は要りません。\n"
            "ここまで読めたら、それで十分です。"
        ),
        "question": COMMON_END,
    },

    "middle": {  # パターンB
        "title": "診断メッセージ",
        "observation": (
            "今のあなたは、\n"
            "自分の気持ちより先に相手の反応を考えてしまい、\n"
            "動けなくなることがあるのかもしれません。"
        ),
        "needle": (
            "ちゃんと考えている。\n"
            "ちゃんと気を遣っている。\n"
            "でも、その分、\n"
            "自分の感覚が後回しになっている。\n\n"
            "「どうしたいのかわからない」\n"
            "その言葉が浮かぶとしたら、\n"
            "それは考えていないからではなく、\n"
            "感じる余白がなかっただけです。\n\n"
            "無理に答えを出さなくていい。\n"
            "今日は、\n"
            "「何か引っかかった」という事実だけを\n"
            "持ち帰ってください。"
        ),
        "question": COMMON_END,
    },

    "strong": {  # パターンC
        "title": "診断メッセージ",
        "observation": (
            "今のあなたは、\n"
            "自分の気持ちよりも、\n"
            "場の空気や誰かの期待を優先することが\n"
            "当たり前になっているのかもしれません。"
        ),
        "needle": (
            "それは、\n"
            "あなたが甘いからでも、弱いからでもありません。\n"
            "そうしないと生きられない時間を、\n"
            "ちゃんと乗り越えてきた人だからです。\n\n"
            "本当は断りたかった。\n"
            "本当は嫌だった。\n"
            "そんな記憶に、\n"
            "ふたをしてきたことがあるなら――\n"
            "それも、あなたなりの選択でした。\n\n"
            "今日は、\n"
            "「私は何も間違っていなかったかもしれない」\n"
            "その可能性だけ、\n"
            "そっと置いていってください。\n\n"
            "言葉が出なくても、大丈夫です。"
        ),
        "question": COMMON_END,
    },
}


def build_message(score: int) -> dict:
    level = get_level(score)
    data = MESSAGES[level]
    return {
        "level": level,
        "title": data["title"],
        "observation": data["observation"],
        "needle": data["needle"],
        "question": data["question"],
    }
