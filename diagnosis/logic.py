# diagnosis/logic.py
import random

# ★ここは「絶対に変えない」固定文（あなた指定の文言そのまま）
CTA_TEXT = (
    "もう少し言葉を受け取りたいと思われたらこちらからご連絡ください。\n"
    "1通のメールをお返しします。"
)

MESSAGES = {
    "light": {
        "observation": [
            "あなたは、ふだんは物事を自分の感覚で決められる場面が多いようです。",
            "今回の回答を見るかぎり、基本は「自分で選ぶこと」ができているタイプです。",
        ],
        "mirror": [
            "ただ、忙しいときや焦っているときだけ、つい人に合わせて決めてしまうことがあるようです。",
            "ただ、状況が重なると「波風が立たない方」を先に選びやすい場面がありそうです。",
        ],
        "lead": [
            "そういう場面では、気づかないうちに「安全な方」を優先する傾向が多くみられます。",
            "その瞬間だけ、判断の基準が「自分」ではなく「外」に寄りやすくなります。",
        ],
        "question": [
            "その流れに、気づいていますか？",
            "最近、その場面が増えていませんか？",
        ],
    },

    "middle": {
        "observation": [
            "あなたは、自分で決めたい気持ちがあるのに、最後に人の反応が気になってしまうところがありそうです。",
            "あなたは、「自分で選ぶこと」と「人に合わせること」が、場面によって入れ替わりやすいタイプかもしれません。",
        ],
        "mirror": [
            "相手の期待を感じたとき、本音より「無難な答え」を選びやすくなっていませんか？",
            "空気を読んだ瞬間に、判断がふっと揺れてしまうことはありませんか？",
        ],
        "lead": [
            "そのあとで「これでよかったかな」が頭に残りやすく、決めたことを不安に思うことがあります。",
            "そういう流れが続くと、決めること自体がしんどくなって、あとから疲れが出やすいです。",
        ],
        "question": [
            "その流れに、気づいていますか？",
            "思い当たる場面が、いま浮かびますか？",
        ],
    },

    "strong": {
        "observation": [
            "あなたは、人の反応を優先して決めてしまうことが多いかもしれません。",
            "あなたは、「自分の気持ちより先に相手を優先すること」が続いている感じが出ています。",
        ],
        "mirror": [
            "そのぶん、自分の本音がどこにあるのか分かりにくくなっている可能性があります。",
            "周りに合わせる時間が長いほど、自分の感覚が後ろに下がってしまうことがあります。",
        ],
        "lead": [
            "本当は違うと思っても、まず「安全な返し方」を選ぶ癖がある状態です。",
            "「自分はどうしたい？」より先に、「どう見られるか」を考えて行動してしまう状態です。",
        ],
        "question": [
            "その流れに、気づいていますか？",
            "気づいたとき、何が変わりそうですか？",
        ],
    },
}

def get_level(score: int) -> str:
    if score >= 22:
        return "strong"
    elif score >= 14:
        return "middle"
    else:
        return "light"

def build_message(score: int) -> dict:
    level = get_level(score)
    data = MESSAGES[level]
    return {
        "level": level,  # 内部用（画面に出さない）
        "observation": random.choice(data["observation"]),
        "mirror": random.choice(data["mirror"]),
        "lead": random.choice(data["lead"]),
        "question": random.choice(data["question"]),
        "cta": CTA_TEXT,
    }
