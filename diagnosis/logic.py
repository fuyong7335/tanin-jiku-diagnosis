# diagnosis/logic.py
import random

# ★ここは「絶対に変えない」固定文（あなた指定の文言そのまま）
CTA_TEXT = (
    "もう少し言葉を受け取りたいと思われたらこちらからご連絡ください。\n"
    "1通のメールをお返しします。"
)

MESSAGES = {
    "light": {
        "observation": [
            "あなたは、ふだんは物事を自分の感覚で決められる場面が多いようです。",
            "今回の回答を見るかぎり、基本は「自分で選ぶこと」ができているタイプです。",
        ],
        "mirror": [
            "ただ、忙しいときや焦っているときだけ、つい相手に合わせて決めてしまうことがあるようです。",
            "ただ、空気を優先した後に、もやもやが残る場面があるかもしれません。",
        ],
        "lead": [
            "その場では丸く収まっても、あとから「本当は違ったかも」が残りやすいタイプです。",
            "合わせた直後に、気持ちが少しだけ置き去りになる感じが出やすいです。",
        ],
        "question": [
            "その流れに、気づいていますか？",
            "最近、その場面が増えていませんか？",
        ],
    },

    "middle": {
        "observation": [
            "あなたは、自分で決めたいのに、最後に人の反応が気になって迷うことがありそうです。",
            "あなたは、「自分で選ぶこと」と「人に合わせること」が、場面によって入れ替わりやすい傾向があるかもしれません。",
        ],
        "mirror": [
            "相手の期待を感じたとき、本音より「無難な答え」を選びやすくなっていませんか？",
            "あとから「これで良かったかな」が頭に残って、決めた事に落ち着けないことがあるかもしれません",
        ],
        "lead": [
            "その積み重ねで、決めること自体が重く感じやすくなります。",
            "迷いが続くと、必要以上に疲れがたまりやすい状態になります。",
        ],
        "question": [
            "思い当たる場面が、いま浮かびますか？",
            "最近、その感じは強くなっていませんか？",
        ],
    },

    "strong": {
        "observation": [
            "あなたは、相手の反応を優先して決める場面が多くなっているかもしれません。",
            "あなたは、「自分の気持ちより先に相手にどう見えるか」を考えてしまうようです。",
        ],
        "mirror": [
            "そのぶん、自分の本音がどこにあるのか分かりにくくなっている可能性があります。",
            "周りに合わせる時間が長いほど、自分の本音が後ろに下がって見えにくくなることがあります。",
        ],
        "lead": [
            "本当は違うと思っても、まず「安全な返し方」を選ぶ癖があり本音が後回しのままになりやすいです。",
            "自分の気持ちを後ろに置く期間が長いほど、戻すのに長い時間が必要になってきます。",
        ],
        "question": [
            "今、自分の本音がわかりにくい感じはありますか？",
            "そのことに気づいたとき、何か変わりそうですか？",
        ],
    },
}

def get_level(score: int) -> str:
    if score >= 22:
        return "strong"
    elif score >= 14:
        return "middle"
    else:
        return "light"

def build_message(score: int) -> dict:
    level = get_level(score)
    data = MESSAGES[level]
    return {
        "level": level,  # 内部用（画面に出さない）
        "observation": random.choice(data["observation"]),
        "mirror": random.choice(data["mirror"]),
        "lead": random.choice(data["lead"]),
        "question": random.choice(data["question"]),
        "cta": CTA_TEXT,
    }
